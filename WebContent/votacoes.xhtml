<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"> 
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:p="http://primefaces.org/ui"> 
	
	<ui:composition>
	
		<script type="text/javascript">
			function showDialog() {
				PrimeFaces.widgets['dlgVotacao'].show();
			}
			function hideDialog() {
				PrimeFaces.widgets['dlgVotacao'].hide();
			}
		</script>
	
		<br/>
		
		<h:form id="formActionMenu">
			<div style="text-align: left; margin-right: 5px;">
				<p:commandButton id="btnCriar" value="Criar" type="submit" icon="ui-icon-plusthick" onclick="showDialog()" update="frmVotacao" style="margin-right: 5px;">
					<f:actionListener binding="#{votacaoController.setAction('CREATE')}"/>
					<f:actionListener binding="#{votacaoController.mountVotacao()}"/>
				</p:commandButton>
				<p:commandButton id="btnExcluir" value="Excluir" type="submit" icon="ui-icon-closethick" action="#{votacaoController.deleteSelectedVotacoes}" update="frmVotacoes:dtVotacoes @this" disabled="#{not votacaoController.isExcluirEnabled()}"/>
			</div>
		</h:form>
		
		<br/>
		
		<p:dialog widgetVar="dlgVotacao" showHeader="false" draggable="false" resizable="false" modal="true" closable="false" width="300px">

		   <h:form id="frmVotacao">
		    	<p:panel id="panel" header="#{votacaoController.action == 'CREATE' ? 'Criar Votação' : 'Editar Votação'}">
			        <h:panelGrid columns="2" cellpadding="5">
			            <h:outputLabel for="data" value="Data:" />
			            <p:calendar id="data" value="#{votacaoController.votacao.data}" mode="inline" />
		    			<h:outputLabel for="realizador" value="Realizador:" />
		    			<p:inputText id="realizador" required="true" value="#{votacaoController.votacao.realizador.nome}" style="width: 185px;" disabled="true"/>
			        </h:panelGrid>
			        <div style="text-align: right; margin-top: 5px">
				    	<p:commandButton value="Salvar" type="submit" icon="ui-icon-check" action="#{votacaoController.saveVotacao()}" update="frmVotacoes:dtVotacoes" onclick="hideDialog();"/>
				    	<p:commandButton value="Fechar" type="button" icon="ui-icon-closethick" onclick="hideDialog();"/>
			    	</div>
			    </p:panel>
		    </h:form>
		    
		</p:dialog>
	
		<h:form id="frmVotacoes">
			<p:dataTable id="dtVotacoes" 
				var="votacao" 
				value="#{votacaoController.votacoes}" 
				selection="#{votacaoController.selectedVotacoes}" 
				rowKey="#{votacao.id}"
				rows="20"
				paginator="true"
				paginatorPosition="bottom"
				emptyMessage="Nenhuma votação localizada.">
				
				<p:ajax event="toggleSelect" update=":formActionMenu:btnExcluir"/>
				<p:ajax event="rowSelectCheckbox" update=":formActionMenu:btnExcluir"/>
        		<p:ajax event="rowUnselectCheckbox" update=":formActionMenu:btnExcluir" />
	        	
	        	<p:column selectionMode="multiple" style="width: 16px; text-align: center"/>
			    <p:column headerText="Data" style="text-align: left; line-height: 25px; border-right-width: 0px">
			    	<h:outputText value="#{votacao.data}" >
			    		<f:convertDateTime pattern="dd/MM/yyyy" />
			    	</h:outputText>
			    </p:column>
			    <p:column headerText="Realizador" style="text-align: left; border-left-width: 0px; border-right-width: 0px">
					<h:outputText value="#{votacao.realizador.nome}" />
			    </p:column>
			    <p:column headerText="Ações" width="100" style="text-align: center; border-left-width: 0px">
					<p:commandButton value="Editar" type="submit" icon="ui-icon-pencil" onclick="showDialog()" update="frmVotacao" style="margin-right: 5px;">
						<f:actionListener binding="#{votacaoController.setAction('UPDATE')}"/>
						<f:actionListener binding="#{votacaoController.setVotacao(votacao)}"/>
					</p:commandButton>
			    </p:column>
			</p:dataTable>
		</h:form>
	</ui:composition>
</html>
